import{_ as i,c as a,o as e,ag as n}from"./chunks/framework.WXS6e2PS.js";const o=JSON.parse('{"title":"从 1.x.x 迁移到 2.x.x","description":"从 2.x 以下版本迁移的指南","frontmatter":{"title":"从 1.x.x 迁移到 2.x.x","description":"从 2.x 以下版本迁移的指南"},"headers":[],"relativePath":"runtimes/apple/migrating-from-1.x.x-to-2.x.x.md","filePath":"runtimes/apple/migrating-from-1.x.x-to-2.x.x.md"}'),l={name:"runtimes/apple/migrating-from-1.x.x-to-2.x.x.md"};function p(t,s,h,k,r,d){return e(),a("div",null,[...s[0]||(s[0]=[n(`<p>Rive Apple 运行时在 2.x.x 版本中提供了与 1.x.x 不同的 API，旨在支持 Storyboard/UIKit 和 SwiftUI 通用的内部模型。</p><p>现在 Rive API 有三个主要部分需要 iOS 开发者熟悉：</p><ul><li><code>RiveView</code>：构建和操作 Rive 视图的核心逻辑</li><li><code>RiveModel</code>：描述 Rive 对象的配置模型</li><li><code>RiveViewModel</code>：集成 Rive 时的主要接口类，在某些情况下负责创建 Rive 视图。它提供了一个高级 API，简化了实例化、动画播放、布局更改等操作。</li></ul><p>我们建议尽快迁移到最新的 v2.x.x 版本，具体步骤如下：</p><h2 id="uikit" tabindex="-1">UIKit <a class="header-anchor" href="#uikit" aria-label="Permalink to &quot;UIKit&quot;">​</a></h2><p>在 v1.x.x 中，您可能使用以下片段模式加载 Rive 文件：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SimpleAnimationViewController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">UIViewController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    let </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;https://cdn.rive.app/animations/truck.riv&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    override</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> func </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">loadView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        super</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">loadView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> view </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RiveView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        guard </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> riveFile </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RiveFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(httpUrl: url, with: view) else {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            fatalError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;无法加载 RiveFile&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> view.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">configure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(riveFile)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        self.view </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> view</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>这种模式与两个 Rive API（<code>RiveFile</code> 和 <code>RiveView</code>）交互。在 v2.x.x 中，模式变得更简单，只需与一个 <code>RiveViewModel</code> 交互。</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SimpleAnimationViewController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">UIViewController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    var </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">viewModel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RiveViewModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fileName: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;truck&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    override</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> func </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">viewWillAppear</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">_</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> animated</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> riveView </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> viewModel.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createRiveView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        view.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addSubview</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(riveView)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        riveView.frame </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> view.frame</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>这是另一个示例：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MultipleAnimationsController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">UIViewController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RivePLayerDelegate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @IBOutlet weak var </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">riveView</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RiveView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">!</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    var </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">viewModel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RiveViewModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        fileName: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;multiple_animations&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        animationName: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Animation 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        artboardName: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Animation Playground&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    override</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> func </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">viewDidLoad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        viewModel.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(riveView)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>有关配合 UIKit 使用动画播放和布局的新用法，请参阅后续的运行时页面。</p><h3 id="状态机用法-state-machine-usage" tabindex="-1">状态机用法 (State Machine Usage) <a class="header-anchor" href="#状态机用法-state-machine-usage" aria-label="Permalink to &quot;状态机用法 (State Machine Usage)&quot;">​</a></h3><p>在 v1.x.x 中，您会使用以下 API 设置状态机输入值： <code>riveView.setNumberState(&quot;Number Test&quot;, inputName: &quot;Level&quot;, value: 2.0)</code></p><p><code>riveView.setBooleanState(&quot;Boolean Test&quot;, inputName: &quot;isSuccess&quot;, value: true)</code></p><p><code>riveView.fireState(&quot;Trigger Test&quot;, inputName: &quot;trigFail&quot;)</code></p><p>在 v2.x.x 中，一些输入状态设置器已被合并并重命名。此外，设置器是在 <code>RiveViewModel</code> 上调用的，该模型已经拥有实例化的状态机上下文，因此不再需要传递名称： <code>viewModel.setInput(&quot;Level&quot;, value: 2.0)</code></p><p><code>viewModel.setInput(&quot;isSuccess&quot;, value: true)</code></p><p><code>viewModel.triggerInput(&quot;trigFail&quot;)</code></p><h3 id="委托-delegates" tabindex="-1">委托 (Delegates) <a class="header-anchor" href="#委托-delegates" aria-label="Permalink to &quot;委托 (Delegates)&quot;">​</a></h3><p>过去，您可能实现了以下部分委托附带的各种函数：<code>LoopDelegate</code>、<code>PlayDelegate</code>、<code>PauseDelegate</code>、<code>StopDelegate</code> 和 <code>StateChangeDelegate</code>。您端实现的各种函数（即 <code>loop</code>、<code>play</code>、<code>pause</code>、<code>stateChange</code> 等）已合并到两个主要委托下：<code>RivePlayerDelegate</code> 和 <code>RiveStateMachineDelegate</code>，其需要覆盖的函数略有不同。</p><p>请参阅以下委托列表以了解可挂载的方法：</p><ul><li><code>RivePlayerDelegate</code>：挂载到动画和状态机生命周期事件 <ul><li><code>player</code>: <code>(loopedWithModel riveModel: RiveModel?, type: Int) {}</code></li><li><code>player</code>: <code>(playedWithModel riveModel: RiveModel?) {}</code></li><li><code>player</code>: <code>(pausedWithModel riveModel: RiveModel?) {}</code></li><li><code>player</code>: <code>(stoppedWithModel riveModel: RiveModel?) {}</code></li></ul></li><li><code>RiveStateDelegate</code>：挂载到状态机生命周期的状态更改 <ul><li><code>stateChange</code>: <code>(_ stateMachineName: String, _ stateName: String) {}</code></li></ul></li></ul><h2 id="swiftui" tabindex="-1">SwiftUI <a class="header-anchor" href="#swiftui" aria-label="Permalink to &quot;SwiftUI&quot;">​</a></h2><p>v1.x.x 曾围绕现有的 <code>RiveView</code> 类提供了一个小型封装，以帮助在 SwiftUI 编写的应用上下文中支持 Rive。v2.x.x 现在支持在 SwiftUI 应用中消费 Rive 的更健壮的模式，修复了现有封装方法的几个错误，并提供了更接近 SwiftUI 新模式的体验。</p><p>关于如何使用 v2.x.x 控制动画播放、状态机等，请参阅后续的运行时页面。</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">struct </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AnimationView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: View {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> body</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> some</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> View</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        RiveViewModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fileName: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cool_rive_animation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">view</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div>`,27)])])}const c=i(l,[["render",p]]);export{o as __pageData,c as default};
