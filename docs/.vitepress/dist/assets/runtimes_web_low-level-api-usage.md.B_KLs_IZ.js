import{_ as i,c as a,o as n,ag as e}from"./chunks/framework.WXS6e2PS.js";const c=JSON.parse('{"title":"低级 API 用法 (Low-level API Usage)","description":"使用低级 JS API 构建 Rive 场景。","frontmatter":{"title":"低级 API 用法 (Low-level API Usage)","description":"使用低级 JS API 构建 Rive 场景。"},"headers":[],"relativePath":"runtimes/web/low-level-api-usage.md","filePath":"runtimes/web/low-level-api-usage.md"}'),l={name:"runtimes/web/low-level-api-usage.md"};function p(t,s,h,k,r,d){return n(),a("div",null,[...s[0]||(s[0]=[e(`<h2 id="背景-background" tabindex="-1">背景 (Background) <a class="header-anchor" href="#背景-background" aria-label="Permalink to &quot;背景 (Background)&quot;">​</a></h2><p>虽然 JS 运行时提供了一个高级 API 以快速将 Rive 集装到 Web 应用中，但运行时还提供了一个更小、更先进的低级 API，允许您在自己的渲染循环中构建和控制 Rive。使用此低级 API 有几个原因和好处：</p><ul><li>在一个 <code>&lt;canvas&gt;</code> 元素中构建由多个 Rive 文件、画板、线性动画和状态机组成的场景。如果您正在制作游戏，这将非常有用！</li><li>控制渲染循环，包括如何随时间推进每个画板、动画和状态机（包括速度控制）。</li><li>能够获取绘制层级结构中节点 (nodes) / 骨骼 (bones) 的多个变换属性值。</li><li>更小的依赖包体积。</li><li>……以及更多！</li></ul><h2 id="前提-premise" tabindex="-1">前提 (Premise) <a class="header-anchor" href="#前提-premise" aria-label="Permalink to &quot;前提 (Premise)&quot;">​</a></h2><p>以下是使用低级 API 渲染 Rive 的基本渲染流程：</p><h3 id="_1-加载-rive-webassembly-wasm-文件-其中包含具有低级-api-的模块" tabindex="-1">1. 加载 Rive WebAssembly (WASM) 文件，其中包含具有低级 API 的模块 <a class="header-anchor" href="#_1-加载-rive-webassembly-wasm-文件-其中包含具有低级-api-的模块" aria-label="Permalink to &quot;1. 加载 Rive WebAssembly (WASM) 文件，其中包含具有低级 API 的模块&quot;">​</a></h3><h3 id="_2-加载-rive-文件" tabindex="-1">2. 加载 Rive 文件 <a class="header-anchor" href="#_2-加载-rive-文件" aria-label="Permalink to &quot;2. 加载 Rive 文件&quot;">​</a></h3><h3 id="_3-为画板-artboards-、线性动画-linearanimations-和状态机-statemachines-创建实例" tabindex="-1">3. 为画板 (Artboards)、线性动画 (LinearAnimations) 和状态机 (StateMachines) 创建实例 <a class="header-anchor" href="#_3-为画板-artboards-、线性动画-linearanimations-和状态机-statemachines-创建实例" aria-label="Permalink to &quot;3. 为画板 (Artboards)、线性动画 (LinearAnimations) 和状态机 (StateMachines) 创建实例&quot;">​</a></h3><h3 id="_4-构建渲染循环函数以操作上述创建的实例" tabindex="-1">4. 构建渲染循环函数以操作上述创建的实例 <a class="header-anchor" href="#_4-构建渲染循环函数以操作上述创建的实例" aria-label="Permalink to &quot;4. 构建渲染循环函数以操作上述创建的实例&quot;">​</a></h3><ul><li><strong>推进并应用任何动画实例</strong></li><li><strong>推进任何状态机实例</strong></li><li><strong>推进画板</strong></li><li><strong>在画布上渲染更新后的画板</strong></li><li><strong>请求下一帧动画</strong></li></ul><h3 id="_5-完成后清理创建的实例" tabindex="-1">5. 完成后清理创建的实例 <a class="header-anchor" href="#_5-完成后清理创建的实例" aria-label="Permalink to &quot;5. 完成后清理创建的实例&quot;">​</a></h3><h2 id="入门-getting-started" tabindex="-1">入门 (Getting Started) <a class="header-anchor" href="#入门-getting-started" aria-label="Permalink to &quot;入门 (Getting Started)&quot;">​</a></h2><p>如果您决定应用需要低级 JS API，请阅读以下指南了解如何设置一切，或者您可以直接跳到最后查看实际运行的示例。</p><h3 id="加载-wasm-loading-in-wasm" tabindex="-1">加载 WASM (Loading in WASM) <a class="header-anchor" href="#加载-wasm-loading-in-wasm" aria-label="Permalink to &quot;加载 WASM (Loading in WASM)&quot;">​</a></h3><p>设置低级 Rive API 的第一步是从 <code>@rive-app/canvas-advanced</code> 或 <code>@rive-app/webgl2-advanced</code> 库中加载 Rive WASM 文件（默认情况下，除非您需要使用 WebGL2，否则我们推荐使用依赖更小的 <code>@rive-app/canvas-advanced</code>）。当 WASM 文件加载到应用中后，您将获得必要的 API，如用于 Canvas/WebGL 的渲染器，以及通过 <a href="https://github.com/rive-app/rive-cpp" target="_blank" rel="noreferrer">rive-cpp</a>（作为多个其他 Rive 运行时基础的核心 C++ 运行时）生成的 JS 类。您将使用这些类在下方的画布中构建您的渲染场景。</p><p>您可以通过 <a href="https://unpkg.com/" target="_blank" rel="noreferrer">unpkg</a> 加载 Rive WASM 文件（它托管了我们的 JS 运行时 NPM 模块），这将向 CDN 发起网络请求，或者您也可以选择将 WASM 文件托管在自己的服务器上。使用 <code>unpkg</code> 时，URL 如下所示：</p><p><a href="https://unpkg.com/@rive-app/canvas-advanced@2.26.1/rive.wasm" target="_blank" rel="noreferrer">https://unpkg.com/@rive-app/canvas-advanced@2.26.1/rive.wasm</a></p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>您需要确保 <code>@rive-app/canvas-advanced@</code> 或 <code>@rive-app/webgl2-advanced@</code> 结尾的版本号与您在应用中安装的依赖版本相匹配。例如，如果您在 <code>package.json</code> 中安装了 <code>@rive-app/canvas-advanced@2.26.1</code>，那么您从 unpkg 请求的 Rive WASM 文件应为 <code>https://unpkg.com/@rive-app/canvas-advanced@2.26.1/rive.wasm</code>。 <br> 参阅 <a href="/docs/runtimes/web/preloading-wasm">预加载 WASM</a> 了解如何预加载 WASM。</p></div><p>首先，从库中导入默认模块，然后调用它并传入一个对象，您只需设置一个参数 <code>locateFile</code>。该参数是一个返回 WASM 文件 URI 的函数，可以是 <code>unpkg</code> URL 或是您自托管版本的 URI。只需 <code>await</code> 调用解析完成，您就会获得对低级 Rive 运行时 API 的引用。</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RiveCanvas </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@rive-app/canvas-advanced&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rive</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RiveCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    locateFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;https://unpkg.com/@rive-app/canvas-advanced@2.26.1/rive.wasm&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="创建渲染器-creating-the-renderer" tabindex="-1">创建渲染器 (Creating the Renderer) <a class="header-anchor" href="#创建渲染器-creating-the-renderer" aria-label="Permalink to &quot;创建渲染器 (Creating the Renderer)&quot;">​</a></h3><p>加载 WASM 后，下一步是使用 <code>makeRenderer()</code> API 创建渲染器，并传入 Rive 应在其上渲染的画布元素。渲染器通过渲染上下文将 Rive 绘制到 <code>&lt;canvas&gt;</code> 元素上。如果您使用的是 <code>@rive-app/canvas-advanced</code>，它将创建一个 Canvas2D 渲染上下文；如果您使用的是 <code>@rive-app/webgl2-advanced</code>，它将创建一个 WebGL 渲染上下文。</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> canvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getElementById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;your-canvas-element&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> renderer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rive.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">makeRenderer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(canvas);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="加载-rive-文件-loading-in-rive-files" tabindex="-1">加载 Rive 文件 (Loading in Rive Files) <a class="header-anchor" href="#加载-rive-文件-loading-in-rive-files" aria-label="Permalink to &quot;加载 Rive 文件 (Loading in Rive Files)&quot;">​</a></h3><p>创建渲染器后，您还可以开始将 Rive 文件加载为 <code>ArrayBuffer</code>，并将其输入到运行时的 <code>load()</code> API 中。您可以从 URL 或项目中的某个位置获取此文件。</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> bytes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;basketball.riv&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">arrayBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 从 Rive 依赖中作为命名导出导入 File</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> file</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rive.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">load</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Uint8Array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bytes))) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> File</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="info custom-block"><p class="custom-block-title">INFO</p><p>确保 <code>await</code> 这个 <code>.load()</code> 调用，因为它会同步尝试从 <code>File</code> 中加载资产。此外，在将 <code>ArrayBuffer</code> 作为参数发送给 <code>.load()</code> 之前，请先将其转换为 <code>Uint8Array</code> 视图。</p></div><h3 id="设置实例-setting-up-the-instances" tabindex="-1">设置实例 (Setting up the Instances) <a class="header-anchor" href="#设置实例-setting-up-the-instances" aria-label="Permalink to &quot;设置实例 (Setting up the Instances)&quot;">​</a></h3><p>获得加载的 <code>File</code> 对象引用后，您可以开始从 Rive 文件中实例化所有的画板、状态机和线性动画。实例化会创建一个底层 C++ 引用，并允许您控制每个实体随时间推进的方式。本指南后面会有更多相关内容。</p><p>您最可能想要实例化的主要组件有：</p><ul><li><code>Artboard</code> —— 从您想要绘制的 Rive 文件中实例化 1 个或多个画板。</li><li><code>StateMachineInstance</code> —— 从给定画板实例化一个状态机。</li><li><code>LinearAnimationInstance</code> —— 从给定画板实例化一个单一时间轴动画。</li></ul><p>首先实例化一个画板，然后您可以从画板引用中创建状态机和线性动画实例，如下所示。</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> artboard</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> file.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">artboardByName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;New Artboard&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> animation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rive.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">LinearAnimationInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  artboard.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">animationByName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;idle&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  artboard</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> stateMachine</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rive.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">StateMachineInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  artboard.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stateMachineByName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;your-state-machine-name&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  artboard</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>在这里最棒的一点是，如果您想在画布上显示多个画板，甚至是同一个画板的多个副本，您可以轻松实现（相比之下，高级 API 一次只能显示一个）。</p><p>除了为渲染循环实例化相关片段外，您还可以提取绘图层级结构中节点 (nodes)、目标 (targets) 和骨骼 (bones) 的引用。如果您需要跟踪给定节点的任何变换属性值用于计算，甚至是获取世界空间或父级变换（例如在动画生命周期内跟踪节点的 x, y 坐标或旋转值），这将非常有用。请参阅指南底部的示例来查看实际应用。</p><h3 id="构建渲染循环-constructing-the-render-loop" tabindex="-1">构建渲染循环 (Constructing the Render Loop) <a class="header-anchor" href="#构建渲染循环-constructing-the-render-loop" aria-label="Permalink to &quot;构建渲染循环 (Constructing the Render Loop)&quot;">​</a></h3><p>您可能熟悉使用 <code>requestAnimationFrame</code> (rAF) 在浏览器重绘周期之间逐帧构建动画。如果不熟悉，可以参考 <a href="https://developer.mozilla.org/en-US/docs/Games/Anatomy#building_a_main_loop_in_javascript" target="_blank" rel="noreferrer">此指南</a> 作为构建渲染循环的起点。</p><p>在 Rive 渲染循环的情况下，您将使用封装了 rAF 的自定义 Rive API，因此需要使用 <code>rive.requestAnimationFrame()</code> 以及 <code>rive.cancelAnimationFrame()</code>。其结构应与您为其他动画构建的任何 rAF 循环类似，但您将通过推进上述创建的实例并根据需要将画板对齐到画布。</p><p>首先，为 rAF 周期创建回调循环，并记录自上一次 rAF 回调以来的时间，以秒为单位获取流逝时间。然后，使用渲染器的 <code>.clear()</code> API 清除画布。</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lastTime </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> renderLoop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">time</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">lastTime) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    lastTime </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> elapsedTimeMs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lastTime;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> elapsedTimeSec</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> elapsedTimeMs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  lastTime </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  renderer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clear</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  rive.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">requestAnimationFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(renderLoop);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rive.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">requestAnimationFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(renderLoop);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="推进动画-advancing-animations" tabindex="-1">推进动画 (Advancing Animations) <a class="header-anchor" href="#推进动画-advancing-animations" aria-label="Permalink to &quot;推进动画 (Advancing Animations)&quot;">​</a></h4><p><code>LinearAnimationInstance</code> 具有一组应用于画板中对象的关键帧。在渲染循环中，您需要对创建的动画实例调用 <code>.advance()</code>，以获取这些关键帧，并按照 API 名称所示，将动画推进一定的时间量（以秒为单位）。</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>通常，您会希望按照上面计算的流逝时间来推进动画，以便以“正常”速度播放（或者更确切地说，是以该时间轴动画设置的任何速度播放）。通过低级 API 控制渲染循环，您可以按自定义时间值推进实例，例如流逝时间的一半（以 0.5 倍速播放）甚至流逝时间的两倍（以 2 倍速播放）。您甚至可以将流逝时间乘以 -1 来反向运行动画。</p></div><p>除了推进线性动画外，您还需要将关键帧值应用到该动画在画板中相关对象的属性上，并通过 <code>.apply()</code> 调用指定动画的混合 (mix) 值。当动画应用关键帧的插值时，它会将这些值与画板对象上的当前值混合。这允许您“混合”动画，如果您有两个动画实例在同一个对象的相同属性上应用关键帧值，这将非常有用。用新关键帧值替换旧属性值的默认混合值应为 <code>1</code>。</p><p>将动画值应用到画板后，推进画板（详见下文）以更新画板对象并解析属性值的更改。</p><p>综上所述，推进线性动画的操作顺序如下：</p><div class="language-css vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">css</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">推进动画 -</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 应用动画值 -</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 推进画板</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>参考以下代码片段：</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> renderLoop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">time</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">lastTime) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    lastTime </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> elapsedTimeMs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lastTime;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> elapsedTimeSec</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> elapsedTimeMs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  lastTime </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  renderer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clear</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  animation.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">advance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(elapsedTimeSec);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  animation.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apply</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  artboard.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">advance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(elapsedTimeSec);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="推进状态机-advancing-state-machines" tabindex="-1">推进状态机 (Advancing State Machines) <a class="header-anchor" href="#推进状态机-advancing-state-machines" aria-label="Permalink to &quot;推进状态机 (Advancing State Machines)&quot;">​</a></h4><p><code>StateMachineInstance</code> 与上述 <code>LinearAnimationInstance</code> 流程类似，但有几点不同。使用状态机时，您不需要应用混合值，因为对应于一个画板您应该只有一个状态机实例，并且混合值由时间轴动画之间设置的过渡决定。此外，<code>.advance()</code> 方法会直接更新画板上对象的属性。因此，推进状态机的操作顺序简化为：</p><div class="language-css vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">css</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">推进状态机 -</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 推进画板</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>参考以下代码示例：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> renderLoop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">time</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">lastTime) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    lastTime </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> elapsedTimeMs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lastTime;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> elapsedTimeSec</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> elapsedTimeMs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  lastTime </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  renderer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clear</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  stateMachine.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">advance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(elapsedTimeSec);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  artboard.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">advance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(elapsedTimeSec);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="推进画板-advancing-the-artboard" tabindex="-1">推进画板 (Advancing the Artboard) <a class="header-anchor" href="#推进画板-advancing-the-artboard" aria-label="Permalink to &quot;推进画板 (Advancing the Artboard)&quot;">​</a></h4><p>如前所述，推进画板将在通过动画和/或状态机应用值后，完成更新层级结构中相关对象的工作。如果您同时控制多个动画，则只需在渲染循环中推进一次画板。如果您在画布中为场景控制多个画板，则根据需要在渲染循环中推进每个画板。</p><h4 id="对齐与渲染-align-and-render" tabindex="-1">对齐与渲染 (Align and Render) <a class="header-anchor" href="#对齐与渲染-align-and-render" aria-label="Permalink to &quot;对齐与渲染 (Align and Render)&quot;">​</a></h4><p>渲染循环中最后要考虑的部分是设置画板的对齐方式，设置绘图区域和画板的边界，最后将渲染上下文传递给画板，以便在画布中绘制画板。</p><p>推进画板后，在渲染上下文上调用 <code>save()</code> API 以保存画布状态。然后对上下文调用 <code>align()</code> API，提供以下内容：</p><ol><li><code>Fit</code> (填充模式) 和 <code>Alignment</code> (对齐方式) 的值。</li><li>要绘制到的画布空间边界。</li><li>在该空间内绘制 Rive 内容的边界。</li></ol><p>关于 <code>Fit</code> 和 <code>Alignment</code> 的选项请 <a href="/docs/runtimes/layout">参阅此处</a>。对于后两个参数，请提供一个轴对齐包围盒 (AABB)。参考下方有关 <code>align()</code> API 的代码片段。</p><p>最后，在调用 <code>align()</code> 之后，通过 <code>draw()</code> 方法将渲染器传递给画板以在画布上绘制画板，最后在渲染器上调用 <code>restore()</code> API 以恢复保存的画布状态。</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>如果您使用的是 <code>@rive-app/webgl2-advanced</code>，则需要调用 <code>renderer.flush()</code> 来清空不同的缓冲指令。</p></div><p>最后要做的是通过此回调调用 Rive 的 <code>requestAnimationFrame</code>，以排队等待下一帧的回调。</p><p>完整代码如下所示：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> renderLoop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">time</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">lastTime) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    lastTime </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> elapsedTimeMs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lastTime;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> elapsedTimeSec</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> elapsedTimeMs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  lastTime </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  renderer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clear</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  stateMachine.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">advance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(elapsedTimeSec);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  artboard.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">advance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(elapsedTimeSec);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  renderer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">save</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  renderer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">align</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    rive.Fit.contain,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    rive.Alignment.center,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      minX: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      minY: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      maxX: canvas.width,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      maxY: canvas.height</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    artboard.bounds,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  artboard.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">draw</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(renderer);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  renderer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">restore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 如果使用 WebGL，可选调用下方函数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // renderer.flush()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  rive.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">requestAnimationFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(renderLoop);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rive.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">requestAnimationFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(renderLoop);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>至此，您应该能够在画布上渲染 Rive 了！</p><h3 id="清理实例-cleaning-up-instances" tabindex="-1">清理实例 (Cleaning Up Instances) <a class="header-anchor" href="#清理实例-cleaning-up-instances" aria-label="Permalink to &quot;清理实例 (Cleaning Up Instances)&quot;">​</a></h3><p>对于创建的每个 C++ 实例，当您完成使用后都需要将其删除，以免应用程序出现内存泄漏。不幸的是，这是一项手动操作，因为我们还不能依赖浏览器中新的终结器 (finalizer) API 来进行垃圾回收。当不再需要从 Rive 运行时创建的任何实例时，请对其调用 <code>.delete()</code> API。示例如下：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 创建的实例</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> renderer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rive.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">makeRenderer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(canvas);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> bytes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;basketball.riv&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">arrayBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> file</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rive.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">load</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Uint8Array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bytes))) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> File</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> artboard</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> file.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">artboardByName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;New Artboard&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> animation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rive.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">LinearAnimationInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  artboard.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">animationByName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;idle&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  artboard</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> stateMachine</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rive.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">StateMachineInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  artboard.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stateMachineByName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;your-state-machine-name&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  artboard</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">renderer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">file.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">artboard.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">animation.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">stateMachine.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="示例-examples" tabindex="-1">示例 (Examples) <a class="header-anchor" href="#示例-examples" aria-label="Permalink to &quot;示例 (Examples)&quot;">​</a></h2><p>请参阅下方链接，了解演示低级 JS API 用法的示例：</p><ul><li><a href="https://codesandbox.io/p/sandbox/canvas-advance-api-example-s6dz3m?file=%2Fsrc%2Findex.ts" target="_blank" rel="noreferrer">@rive-app/canvas-advanced 的简单用法</a></li><li><a href="https://codesandbox.io/p/sandbox/rive-webgl-advanced-57lczl?file=%2Fsrc%2Findex.ts" target="_blank" rel="noreferrer">@rive-app/webgl2-advanced 的简单用法</a></li><li><a href="https://codesandbox.io/p/sandbox/rive-canvas-advanced-out-of-band-assets-fonts-3q4zzy?file=%2Fsrc%2Findex.ts" target="_blank" rel="noreferrer">带外资源（字体）的使用 @rive-app/canvas-advanced</a></li></ul><h2 id="api-参考-api-references" tabindex="-1">API 参考 (API References) <a class="header-anchor" href="#api-参考-api-references" aria-label="Permalink to &quot;API 参考 (API References)&quot;">​</a></h2><p>请参阅我们的 <a href="https://github.com/rive-app/rive-wasm/blob/master/js/src/rive_advanced.mjs.d.ts" target="_blank" rel="noreferrer">类型文件</a> 以了解高级 API，从而掌握 API 签名和返回类型。</p><h2 id="注意事项-caveats" tabindex="-1">注意事项 (Caveats) <a class="header-anchor" href="#注意事项-caveats" aria-label="Permalink to &quot;注意事项 (Caveats)&quot;">​</a></h2><p>高级 JS 运行时 API 是使用上述低级 API 构建的。除此之外，高级 JS 运行时还具有额外的功能，方便用户执行以下操作：</p><ul><li>通过 <code>.play()</code>、<code>.pause()</code>、<code>.stop()</code> 等 API 轻松控制播放。</li><li>提供 <code>onStateChange</code>、<code>onLoad</code> 等回调，允许您挂钩到特定的 Rive 生命周期事件。</li><li>将手势事件挂钩到 <a href="/docs/editor/state-machine/listeners">Rive 监听器 (Rive Listeners)</a>。</li></ul><p>当使用 Rive 的高级 JS API 自定义 Rive 的使用方式时，您需要自己设置其中一些功能。请查看 <a href="https://github.com/rive-app/rive-wasm/blob/master/js/src/rive.ts" target="_blank" rel="noreferrer">此处的高级 Rive API 构建方式</a>，以了解在需要时如何复制这些高级功能。</p><h2 id="将-rive-集装到现有的-raf-循环中" tabindex="-1">将 Rive 集装到现有的 rAF 循环中 <a class="header-anchor" href="#将-rive-集装到现有的-raf-循环中" aria-label="Permalink to &quot;将 Rive 集装到现有的 rAF 循环中&quot;">​</a></h2><p>如果您希望将 Rive 添加到现有的渲染循环（JS API <code>requestAnimationFrame()</code>）中，并且不想使用 Rive 封装的 <code>requestAnimationFrame()</code> API，可以通过在渲染循环末尾额外调用一个 API 来实现。在重新调用 <code>requestAnimationFrame()</code> 之前，在渲染循环末尾调用 <code>rive.resolveAnimationFrame()</code> API。</p><p>更多用法请参阅 <a href="/docs/runtimes/web/rive-parameters">Rive 参数 (Rive Parameters)</a> 文档。</p>`,82)])])}const g=i(l,[["render",p]]);export{c as __pageData,g as default};
