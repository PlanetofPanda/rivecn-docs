import{_ as i,c as a,o as n,ag as e}from"./chunks/framework.WXS6e2PS.js";const o=JSON.parse('{"title":"预加载 WASM (Preloading WASM)","description":"关于如何预加载和自托管 Rive WASM 库。","frontmatter":{"title":"预加载 WASM (Preloading WASM)","description":"关于如何预加载和自托管 Rive WASM 库。"},"headers":[],"relativePath":"runtimes/web/preloading-wasm.md","filePath":"runtimes/web/preloading-wasm.md"}'),p={name:"runtimes/web/preloading-wasm.md"};function l(t,s,h,r,k,d){return n(),a("div",null,[...s[0]||(s[0]=[e(`<h2 id="背景-background" tabindex="-1">背景 (Background) <a class="header-anchor" href="#背景-background" aria-label="Permalink to &quot;背景 (Background)&quot;">​</a></h2><p>当您使用 <code>@rive-app/*</code> 包中的 <code>new Rive()</code> 实例，或者 <code>@rive-app/react-*</code> 包中的 <code>&lt;RiveComponent /&gt;</code> 时，浏览器会向 <code>https://unpkg.com/@rive-app/canvas@x.x.x/rive.wasm</code> 发起网络请求。该请求获取一个包含 Rive 特定 API 的 <a href="https://developer.mozilla.org/en-US/docs/WebAssembly" target="_blank" rel="noreferrer">WebAssembly</a> (WASM) 文件，用于构建渲染循环。<a href="https://unpkg.com/" target="_blank" rel="noreferrer">unpkg</a> 是一个全球 CDN，允许快速加载 NPM 包，在这种情况下是 WASM 文件。这使得引入基于 JS 的 Rive 运行时时包体积更小，且仅在创建 Rive 实例时才加载 WASM。</p><p>虽然 <code>unpkg</code> 应该能快速提供 WASM 且支持跨站缓存，但由于以下原因，您可能希望自己预加载并托管该 WASM 文件：</p><ul><li>增强驱动 Rive 动画的 WASM 的可靠性。</li><li>缩短动画加载时间。</li><li>控制 Web 应用资源加载的时机。</li></ul><h2 id="步骤-steps" tabindex="-1">步骤 (Steps) <a class="header-anchor" href="#步骤-steps" aria-label="Permalink to &quot;步骤 (Steps)&quot;">​</a></h2><p>根据您使用的基于 JS 的运行时（如纯 JS、React 等），请参考以下章节来手动托管从基础 JS 运行时加载的 WASM。</p><h3 id="纯-js-js" tabindex="-1">纯 JS (JS) <a class="header-anchor" href="#纯-js-js" aria-label="Permalink to &quot;纯 JS (JS)&quot;">​</a></h3><p>如果您使用的是基础的 <code>@rive-app/canvas</code> 或 <code>@rive-app/webgl</code>，或者是任何纯 JS 变体的 Rive 运行时，请在您的应用中导入 WASM 资源以及 <code>RuntimeLoader</code> API：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> riveWASMResource </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@rive-app/canvas/rive.wasm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { Rive, RuntimeLoader } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@rive-app/canvas&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RuntimeLoader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setWasmUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(riveWASMResource);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ...</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> riveInstance</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Rive</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  src: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;foo.riv&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><code>RuntimeLoader</code> 是一个单例，负责在加载 <code>Rive</code> 实例时在后台管理 WASM 文件的加载。通过调用 <code>setWasmUrl</code> API，您可以使用直接导入的 WASM 文件的 Data URI 来为 Rive 运行时加载 WASM。请在任何包含 Rive 动画待加载的页面上运行此 API。</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>您可能需要在构建工具中进行配置，以支持导入 WASM 文件并将其内联为 Data URI。可以参考启发我们添加本指南的 <a href="https://dev.to/alex_barashkov/optimization-techniques-for-rive-animations-in-react-apps-1a8p" target="_blank" rel="noreferrer">原始博客文章</a> 获取指导。</p></div><h3 id="react" tabindex="-1">React <a class="header-anchor" href="#react" aria-label="Permalink to &quot;React&quot;">​</a></h3><p>如果您使用的是 <code>@rive-app/react-canvas</code> 或 <code>@rive-app/react-webgl</code>，请在应用中导入 WASM 资源以及 <code>RuntimeLoader</code> API：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> riveWASMResource </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@rive-app/canvas/rive.wasm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { useRive, RuntimeLoader } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@rive-app/react-canvas&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RuntimeLoader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setWasmUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(riveWASMResource);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyComponent</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">rive</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">RiveComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useRive</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    src: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;foo.riv&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><code>RuntimeLoader</code> 是一个单例，负责在后台管理 WASM 文件的加载。通过调用 <code>setWasmUrl</code> API，您可以使用直接导入的 WASM 文件的 Data URI 来加载 WASM。</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>您可能需要在构建工具中进行配置才能导入 WASM 文件。请参考启发我们添加本指南的 <a href="https://dev.to/alex_barashkov/optimization-techniques-for-rive-animations-in-react-apps-1a8p" target="_blank" rel="noreferrer">原始博客文章</a> 以获取相关指导。</p></div><p>如果您在构建工具中设置了为应用加载 WebAssembly，您还可以在创建 Rive 实例的相关页面中预加载 WASM 模块，从而快速实例化 Rive 动画。</p><p>例如在 Next.js 中，您可以在主页面布局中添加以下内容：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { Html, Head } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;next/document&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> riveWASMResource </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@rive-app/canvas/rive.wasm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Document</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Head</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">link</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;preload&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> href</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{riveWASMResource} </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">as</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;fetch&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> crossOrigin</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;anonymous&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Head</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>您可能需要安装与 <code>@rive-app/react-canvas</code> 中所绑定的 JS 版本一致的 <code>@rive-app/canvas</code>，否则可能会在运行时遇到问题。例如，<code>@rive-app/react-canvas@3.0.33</code> 绑定的 JS 依赖版本为 <code>@rive-app/canvas@1.0.95</code>；因此，您应安装该特定版本的 JS 运行时以确保兼容性。</p><h2 id="特别鸣谢-special-thanks" tabindex="-1">特别鸣谢 (Special Thanks) <a class="header-anchor" href="#特别鸣谢-special-thanks" aria-label="Permalink to &quot;特别鸣谢 (Special Thanks)&quot;">​</a></h2><p>特别鸣谢 Alex Barashkov 撰写的 <a href="https://dev.to/alex_barashkov/optimization-techniques-for-rive-animations-in-react-apps-1a8p" target="_blank" rel="noreferrer">原始博客文章</a>，它启发我们添加了此技巧。</p>`,22)])])}const E=i(p,[["render",l]]);export{o as __pageData,E as default};
